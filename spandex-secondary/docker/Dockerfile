FROM socrata/java8

ENV SERVER_ROOT       /srv/secondary-watcher
ENV SERVER_ARTIFACT   spandex-secondary-assembly.jar
ENV SERVER_CONFIG     secondary-watcher.conf
ENV CONFIG_LINE       -Dconfig.file=${SERVER_ROOT}/${SERVER_CONFIG}

# general secondary-watcher defaults
ENV TRUTH_CLUSTER alpha
ENV TRUTH_CLUSTER_COLLOCATION_GROUP [alpha]
ENV ENABLE_GRAPHITE false
ENV GRAPHITE_HOST 0.0.0.0
ENV GRAPHITE_PORT 0
ENV JAVA_XMX 512m
ENV LOG_METRICS false
ENV DATA_COORDINATOR_DB_NAME truth
ENV DATA_COORDINATOR_DB_PORT 5432
ENV DATA_COORDINATOR_DB_USER soda_dc
ENV JAVA_MAX_METASPACE 64m

ENV SECONDARY_CONFIG secondary.conf

ENV JAVA_XMX 2g
ENV JMX_PORT 6309
ENV LOG_LEVEL INFO
ENV JAVA_MAX_METASPACE 64m

ENV SPANDEX_SECONDARY_ES_CLUSTER_NAME spandex
ENV SPANDEX_SECONDARY_ES_PORT 9300
ENV SPANDEX_SECONDARY_ES_INDEX_ALIAS spandex
ENV SPANDEX_SECONDARY_NUM_WORKERS 5
ENV SPANDEX_SECONDARY_DATA_COPY_BATCH_SIZE 10000
ENV SPANDEX_SECONDARY_DATA_COPY_TIMEOUT 60s
ENV SPANDEX_SECONDARY_RESYNC_BATCH_SIZE 5000
ENV SPANDEX_SECONDARY_TYPE autocomplete

ENV LOG_LEVEL INFO

WORKDIR $SERVER_ROOT

COPY ship.d /etc/ship.d
COPY ${SECONDARY_CONFIG}.j2 $SERVER_ROOT/
COPY $SECONDARY_ARTIFACT $SERVER_ROOT/
